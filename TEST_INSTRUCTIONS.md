# Инструкции по автотесту WhatsApp-бота

## Что было сделано:

1. ✅ Обновлен `main.py`:
   - При "start" или "старт" → отправляет "Бот активен ✅. Напиши 'меню'."
   - При "меню" → отправляет интерактивные кнопки: ["Вакансии", "Часы", "Помощь"]

2. ✅ Создан `scripts/self_test.py`:
   - Читает .env (WHATSAPP_TOKEN, TEST_MSISDN)
   - Отправляет "start" через 360dialog API
   - Печатает статус ответа

3. ✅ Обновлен `.env.example`:
   - Добавлена переменная TEST_MSISDN=79991234567

## Как запустить тест:

### Шаг 1: Запустите сервер (если еще не запущен)
```powershell
python main.py
```

### Шаг 2: Запустите автотест
```powershell
python .\scripts\self_test.py
```

### Шаг 3: Проверьте WhatsApp на телефоне
- Должно прийти сообщение: **"Бот активен ✅. Напиши 'меню'."**

### Шаг 4: Отправьте "меню" с телефона
- В консоли сервера должны появиться логи
- На телефоне должны появиться кнопки

## Что должно появиться:

### В консоли сервера:

**После запуска self_test.py:**
```
[WEBHOOK] Получен POST /webhook: {...}
[MSG] От 79991234567, тип: text
[TEXT] 79991234567: start
[CMD] Команда 'start' от 79991234567
[OUT] Ответ отправлен 79991234567, статус: OK
```

**После отправки "меню" с телефона:**
```
[WEBHOOK] Получен POST /webhook: {...}
[MSG] От 79991234567, тип: text
[TEXT] 79991234567: меню
[CMD] Команда 'меню' от 79991234567
[OUT] Кнопки отправлены 79991234567, статус: OK
```

### В WhatsApp на телефоне:

**После self_test.py:**
- Сообщение: **"Бот активен ✅. Напиши 'меню'."**

**После отправки "меню":**
- Интерактивные кнопки:
  - **Вакансии**
  - **Часы**
  - **Помощь**

## Формат логов:

- `[IN]` или `[WEBHOOK]` - входящий запрос на /webhook
- `[MSG]` - информация о сообщении
- `[TEXT]` - текст сообщения
- `[CMD]` - распознанная команда
- `[OUT]` - исходящий ответ (статус OK/ERROR)

## Проверка работы:

1. ✅ Сервер запущен на http://127.0.0.1:8000
2. ✅ Webhook endpoint доступен: /webhook
3. ✅ Автотест отправляет сообщение через API
4. ✅ Бот отвечает на команды
5. ✅ Кнопки отправляются корректно

