# ‚úÖ –ü—Ä–æ–µ–∫—Ç –∑–∞–≤–µ—Ä—à—ë–Ω - WhatsApp Bot —Å FSM

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 1: 360dialog Cloud API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

‚úÖ **config.py** - —Ñ—É–Ω–∫—Ü–∏—è `get_headers()`
```python
def get_headers():
    return {
        "Content-Type": "application/json",
        "D360-API-KEY": D360_API_KEY
    }
```

‚úÖ **bot.py** - —Ñ—É–Ω–∫—Ü–∏—è `send_message(to, data)` ‚Üí POST /messages
```python
def send_message(to: str, data: dict) -> bool:
    url = f"{D360_BASE_URL}/v1/messages"
    payload = {"recipient_type": "individual", "to": to, **data}
    response = requests.post(url, json=payload, headers=get_headers())
    return response.status_code in [200, 201]
```

‚úÖ **webhook.py** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON:
- ‚úÖ text message
- ‚úÖ interactive: button_reply.id
- ‚úÖ interactive: list_reply.id

‚úÖ **bot.py** - —Ñ—É–Ω–∫—Ü–∏–∏ `send_buttons()` –∏ `send_list()`
```python
def send_buttons(to: str, text: str, buttons: list) -> bool
def send_list(to: str, text: str, button_text: str, sections: list) -> bool
```

‚úÖ **menu_handlers.py**:
- ‚úÖ `handle_main_menu(phone)` ‚Üí –∫–Ω–æ–ø–∫–∏ "–†–∞–±–æ—Ç–∞", "–ß–∞—Å—ã", "–ü–æ–º–æ—â—å"
- ‚úÖ –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –±–æ—Ç –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é

‚úÖ **utils/state.py** - state-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ:
```python
set_state(phone, state)      # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
get_state(phone)             # –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ  
clear_state(phone)           # –û—á–∏—Å—Ç–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
```

---

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 2: –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è FSM

‚úÖ **–°–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã** (utils/state.py):
```python
class States:
    MAIN_MENU = "MAIN_MENU"
    SELECT_WORK = "SELECT_WORK"
    SELECT_SHIFT = "SELECT_SHIFT"
    SELECT_HOURS = "SELECT_HOURS"
    CONFIRM_SAVE = "CONFIRM_SAVE"
```

‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω**:

1. ‚úÖ –ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí **MAIN_MENU**
2. ‚úÖ –ü—Ä–∏ "–†–∞–±–æ—Ç–∞" ‚Üí **SELECT_WORK** (—Å–ø–∏—Å–æ–∫: "–ü–æ–ª–µ", "–ö–∞–±–∞—á–æ–∫", "–ö–∞—Ä—Ç–æ—à–∫–∞", "–î—Ä—É–≥–æ–µ")
3. ‚úÖ –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–∞–±–æ—Ç—ã ‚Üí **SELECT_SHIFT** (3 —Å–º–µ–Ω—ã)
4. ‚úÖ –ü–æ—Å–ª–µ —Å–º–µ–Ω—ã ‚Üí **SELECT_HOURS** (—Å–ø–∏—Å–æ–∫: 4, 6, 8, 12 —á–∞—Å–æ–≤)
5. ‚úÖ –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ ‚Üí **CONFIRM_SAVE** (–∫–Ω–æ–ø–∫–∏ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" –∏ "–û—Ç–º–µ–Ω–∞")

‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ webhook.py**:
```python
if current_state == States.SELECT_WORK:
    logger.info(f"[FSM] –°–æ—Å—Ç–æ—è–Ω–∏–µ SELECT_WORK - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–∞–±–æ—Ç—ã")

if current_state == States.SELECT_SHIFT:
    logger.info(f"[FSM] –°–æ—Å—Ç–æ—è–Ω–∏–µ SELECT_SHIFT - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å–º–µ–Ω—ã")

if current_state == States.SELECT_HOURS:
    logger.info(f"[FSM] –°–æ—Å—Ç–æ—è–Ω–∏–µ SELECT_HOURS - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —á–∞—Å–æ–≤")

if current_state == States.CONFIRM_SAVE:
    logger.info(f"[FSM] –°–æ—Å—Ç–æ—è–Ω–∏–µ CONFIRM_SAVE - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è")
```

‚úÖ **–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ menu_handlers.py**:
- ‚úÖ `handle_main_menu()`
- ‚úÖ `handle_select_work()`
- ‚úÖ `handle_select_shift()`
- ‚úÖ `handle_select_hours()`
- ‚úÖ `handle_show_confirmation()`
- ‚úÖ `handle_confirm_save()`

‚úÖ **FSM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç utils/state.py**:
```python
from utils.state import get_state, set_state, clear_state, States

# –í –∫–∞–∂–¥–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ:
set_state(phone, States.SELECT_WORK)
current_state = get_state(phone).get('state')
```

‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ utils/sheets.save_entry()**:
```python
def handle_confirm_save(phone: str, confirmed: bool):
    if confirmed:
        work = get_user_data(phone, 'work')
        shift = get_user_data(phone, 'shift')
        hours = get_user_data(phone, 'hours')
        
        save_entry(phone, work, shift, hours)  # ‚Üê –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏!
        
        clear_state(phone)
        handle_main_menu(phone)
```

‚úÖ **–§—É–Ω–∫—Ü–∏—è save_entry() —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞** (utils/sheets.py):
```python
def save_entry(phone: str, work: str, shift: str, hours: str) -> bool:
    timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    entry_data = {...}
    logger.info(f"üìù [SAVE] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏: {entry_data}")
    # TODO: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Sheets API
    return True  # –ó–∞–≥–ª—É—à–∫–∞ –≥–æ—Ç–æ–≤–∞
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | –°–æ—Å—Ç–æ—è–Ω–∏–µ |
|-----------|------------|-----------|
| `bot.py` | 226 | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| `webhook.py` | 162 | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| `menu_handlers.py` | 437 | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| `config.py` | 59 | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| `utils/state.py` | 151 | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| `utils/sheets.py` | 106 | ‚úÖ –ì–æ—Ç–æ–≤–æ (–∑–∞–≥–ª—É—à–∫–∞) |
| `test_fsm.py` | 367 | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| `test_360dialog_api.py` | 286 | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| **–ò–¢–û–ì–û** | **1794** | **‚úÖ 100%** |

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ö–æ–¥
- ‚úÖ `bot.py` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, Flask —Å–µ—Ä–≤–µ—Ä
- ‚úÖ `webhook.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö + FSM —Ä–æ—É—Ç–∏–Ω–≥
- ‚úÖ `menu_handlers.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ FSM —Å–æ—Å—Ç–æ—è–Ω–∏–π
- ‚úÖ `config.py` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è + get_headers()
- ‚úÖ `utils/state.py` - FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- ‚úÖ `utils/sheets.py` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (save_entry)
- ‚úÖ `utils/__init__.py` - —ç–∫—Å–ø–æ—Ä—Ç—ã

### –¢–µ—Å—Ç—ã
- ‚úÖ `test_fsm.py` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ FSM (5/5 —Ç–µ—Å—Ç–æ–≤ ‚úì)
- ‚úÖ `test_360dialog_api.py` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ 360dialog API

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `README_FSM.md` - –≥–ª–∞–≤–Ω–æ–µ README —Å quickstart
- ‚úÖ `FSM_GUIDE.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ FSM
- ‚úÖ `FSM_IMPLEMENTATION_COMPLETE.md` - –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ FSM
- ‚úÖ `FSM_DIAGRAM.txt` - –≤–∏–∑—É–∞–ª—å–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ FSM
- ‚úÖ `USAGE_EXAMPLE.md` - –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è 360dialog API
- ‚úÖ `IMPLEMENTATION_COMPLETE.md` - —Å–≤–æ–¥–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ 360dialog API
- ‚úÖ `PROJECT_COMPLETE.md` - –∏—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

---

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç—ã FSM (test_fsm.py)

```
‚úì PASSED  –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π
‚úì PASSED  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
‚úì PASSED  –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
‚úì PASSED  –ü–æ–ª–Ω—ã–π FSM –ø–æ—Ç–æ–∫
‚úì PASSED  –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ò—Ç–æ–≥–æ: 5/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ
‚úì –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ! üéâ
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–∞

```
No linter errors found.
```

---

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**360dialog Cloud API:**
- [x] –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- [x] –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (button reply)
- [x] –°–ø–∏—Å–∫–∏ (list message)
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö text messages
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ button_reply
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ list_reply
- [x] Webhook –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

**FSM (–ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π):**
- [x] 5 —Å–æ—Å—Ç–æ—è–Ω–∏–π (MAIN_MENU, SELECT_WORK, SELECT_SHIFT, SELECT_HOURS, CONFIRM_SAVE)
- [x] –ü–æ–ª–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å
- [x] –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ –ø–∞–º—è—Ç–∏
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏
- [x] –û—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- [x] –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (start, help, cancel)
- [x] –≠–º–æ–¥–∑–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- [x] –û–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –∏ —Å–ø–∏—Å–∫–æ–≤
- [x] –°–≤–æ–¥–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- [x] –°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–∞—Ö

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
cd "C:\BOTIKI\bot whats app"
pip install -r requirements_whatsapp.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:

```env
D360_API_KEY=your_360dialog_api_key_here
D360_BASE_URL=https://waba-v2.360dialog.io
VERIFY_TOKEN=your_verify_token_here
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
```

### 3. –ó–∞–ø—É—Å–∫

```bash
python bot.py
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç—ã FSM
python test_fsm.py

# –¢–µ—Å—Ç—ã API (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π API –∫–ª—é—á)
python test_360dialog_api.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
curl http://localhost:8000/health
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã:
1. **README_FSM.md** - –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å quickstart
2. **FSM_DIAGRAM.txt** - –≤–∏–∑—É–∞–ª—å–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

### –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏:
3. **FSM_GUIDE.md** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ FSM
4. **USAGE_EXAMPLE.md** - –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
5. **FSM_IMPLEMENTATION_COMPLETE.md** - –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ FSM
6. **IMPLEMENTATION_COMPLETE.md** - –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ API
7. **PROJECT_COMPLETE.md** - –∏—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

---

## üé® –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: start

–ë–æ—Ç: ü§ñ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ TERRA Bot!
     –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:
     [üìã –†–∞–±–æ—Ç–∞] [‚è∞ –ò–Ω—Ñ–æ –æ —á–∞—Å–∞—Ö] [‚ùì –ü–æ–º–æ—â—å]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–ù–∞–∂–∞–ª "–†–∞–±–æ—Ç–∞"]

–ë–æ—Ç: üìã –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞–±–æ—Ç—ã:
     [üåæ –ü–æ–ª–µ] [ü•í –ö–∞–±–∞—á–æ–∫] [ü•î –ö–∞—Ä—Ç–æ—à–∫–∞] [üì¶ –î—Ä—É–≥–æ–µ]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–í—ã–±—Ä–∞–ª "–ü–æ–ª–µ"]

–ë–æ—Ç: ‚úÖ –†–∞–±–æ—Ç–∞ –≤—ã–±—Ä–∞–Ω–∞: –ü–æ–ª–µ
     ‚è∞ –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ —Å–º–µ–Ω—É:
     [‚òÄÔ∏è –°–º–µ–Ω–∞ 1 (8-16)] [üåÜ –°–º–µ–Ω–∞ 2 (16-00)] [üåô –°–º–µ–Ω–∞ 3 (00-8)]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–í—ã–±—Ä–∞–ª "–°–º–µ–Ω–∞ 1 (8-16)"]

–ë–æ—Ç: ‚úÖ –†–∞–±–æ—Ç–∞: –ü–æ–ª–µ
     ‚úÖ –°–º–µ–Ω–∞: 8-16
     ‚è±Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤:
     [4 —á–∞—Å–∞] [6 —á–∞—Å–æ–≤] [8 —á–∞—Å–æ–≤] [12 —á–∞—Å–æ–≤]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–í—ã–±—Ä–∞–ª "8 —á–∞—Å–æ–≤"]

–ë–æ—Ç: üìù –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º:
     ‚ñ´Ô∏è –†–∞–±–æ—Ç–∞: –ü–æ–ª–µ
     ‚ñ´Ô∏è –°–º–µ–Ω–∞: 8-16
     ‚ñ´Ô∏è –ß–∞—Å–æ–≤: 8
     –í—Å–µ –≤–µ—Ä–Ω–æ?
     [‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å] [‚ùå –û—Ç–º–µ–Ω–∞]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–ù–∞–∂–∞–ª "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"]

–ë–æ—Ç: ‚úÖ –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!
     üìã –†–∞–±–æ—Ç–∞: –ü–æ–ª–µ
     ‚è∞ –°–º–µ–Ω–∞: 8-16
     ‚è±Ô∏è –ß–∞—Å–æ–≤: 8
     –°–ø–∞—Å–∏–±–æ! –í–æ–∑–≤—Ä–∞—â–∞—é –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é...
```

---

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Sheets

–í `utils/sheets.py` –∑–∞–º–µ–Ω–∏—Ç—å –∑–∞–≥–ª—É—à–∫—É –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é:

```python
def save_entry(phone: str, work: str, shift: str, hours: str) -> bool:
    from google.oauth2 import service_account
    from googleapiclient.discovery import build
    
    # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    credentials = service_account.Credentials.from_service_account_file(
        SHEETS_CREDENTIALS,
        scopes=['https://www.googleapis.com/auth/spreadsheets']
    )
    
    # –°–µ—Ä–≤–∏—Å
    service = build('sheets', 'v4', credentials=credentials)
    
    # –î–∞–Ω–Ω—ã–µ
    timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    values = [[timestamp, phone, work, shift, hours]]
    
    # –ó–∞–ø–∏—Å—å
    body = {'values': values}
    result = service.spreadsheets().values().append(
        spreadsheetId=SHEET_ID,
        range='Sheet1!A:E',
        valueInputOption='RAW',
        body=body
    ).execute()
    
    return True
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ó–∞–º–µ–Ω–∏—Ç—å in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞ SQLite/PostgreSQL:

```python
# utils/database.py
import sqlite3

def save_state(phone, state, data):
    conn = sqlite3.connect('bot.db')
    # ...
```

---

## üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- API –∫–ª—é—á–∏ –≤ `.env` (–Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è)
- Webhook –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω
- –ú–∏–Ω–∏–º—É–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ª–æ–≥–∞—Ö

### 2. –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 3. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —Ä–∞–±–æ—Ç
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 4. UX
- –≠–º–æ–¥–∑–∏ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
- –û–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
- –°–≤–æ–¥–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ | 17 |
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | ~1800 |
| –§–∞–π–ª–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ | 7 |
| –°–æ—Å—Ç–æ—è–Ω–∏–π FSM | 5 |
| –¢–∏–ø–æ–≤ —Ä–∞–±–æ—Ç | 4 |
| –°–º–µ–Ω | 3 |
| –í–∞—Ä–∏–∞–Ω—Ç–æ–≤ —á–∞—Å–æ–≤ | 4 |
| –¢–µ—Å—Ç–æ–≤ | 5 |
| –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ | 100% |
| –í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ | ~2 —á–∞—Å–∞ |
| –õ–∏–Ω—Ç–µ—Ä –æ—à–∏–±–æ–∫ | 0 |

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

### 360dialog Cloud API
- [x] `config.py`: —Ñ—É–Ω–∫—Ü–∏—è `get_headers()`
- [x] `bot.py`: —Ñ—É–Ω–∫—Ü–∏—è `send_message(to, data)` ‚Üí POST /messages
- [x] `webhook.py`: –æ–±—Ä–∞–±–æ—Ç–∫–∞ text message
- [x] `webhook.py`: –æ–±—Ä–∞–±–æ—Ç–∫–∞ interactive: button_reply.id
- [x] `webhook.py`: –æ–±—Ä–∞–±–æ—Ç–∫–∞ interactive: list_reply.id
- [x] `menu_handlers.py`: `handle_main_menu()` ‚Üí –∫–Ω–æ–ø–∫–∏ "–†–∞–±–æ—Ç–∞", "–ß–∞—Å—ã", "–ü–æ–º–æ—â—å"
- [x] `bot.py`: —Ñ—É–Ω–∫—Ü–∏—è `send_buttons()`
- [x] `bot.py`: —Ñ—É–Ω–∫—Ü–∏—è `send_list()`
- [x] –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ ‚Üí –≤—ã–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏
- [x] `utils/state.py`: `set_state()`, `get_state()`, `clear_state()`
- [x] –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ (dict)

### FSM (–ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π)
- [x] –°–æ—Å—Ç–æ—è–Ω–∏–µ: `MAIN_MENU`
- [x] –°–æ—Å—Ç–æ—è–Ω–∏–µ: `SELECT_WORK`
- [x] –°–æ—Å—Ç–æ—è–Ω–∏–µ: `SELECT_SHIFT`
- [x] –°–æ—Å—Ç–æ—è–Ω–∏–µ: `SELECT_HOURS`
- [x] –°–æ—Å—Ç–æ—è–Ω–∏–µ: `CONFIRM_SAVE`
- [x] –ü–æ—Å–ª–µ start ‚Üí `MAIN_MENU`
- [x] –ü—Ä–∏ "–†–∞–±–æ—Ç–∞" ‚Üí `SELECT_WORK` (—Å–ø–∏—Å–æ–∫: –ü–æ–ª–µ, –ö–∞–±–∞—á–æ–∫, –ö–∞—Ä—Ç–æ—à–∫–∞, –î—Ä—É–≥–æ–µ)
- [x] –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–∞–±–æ—Ç—ã ‚Üí `SELECT_SHIFT` (3 —Å–º–µ–Ω—ã)
- [x] –ü–æ—Å–ª–µ —Å–º–µ–Ω—ã ‚Üí `SELECT_HOURS` (—Å–ø–∏—Å–æ–∫: 4, 6, 8, 12 —á–∞—Å–æ–≤)
- [x] –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ ‚Üí `CONFIRM_SAVE` (–∫–Ω–æ–ø–∫–∏: –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å, –û—Ç–º–µ–Ω–∞)
- [x] `webhook.py`: –æ–±—Ä–∞–±–æ—Ç–∫–∞ `if state == "SELECT_WORK"`
- [x] `webhook.py`: –æ–±—Ä–∞–±–æ—Ç–∫–∞ `if state == "SELECT_SHIFT"`
- [x] `webhook.py`: –æ–±—Ä–∞–±–æ—Ç–∫–∞ `if state == "SELECT_HOURS"`
- [x] `webhook.py`: –æ–±—Ä–∞–±–æ—Ç–∫–∞ `if state == "CONFIRM_SAVE"`
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–µ–Ω—é –≤ `menu_handlers.py`
- [x] FSM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `utils/state.py`
- [x] –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Üí `utils.sheets.save_entry(phone, work, shift, hours)`
- [x] –§—É–Ω–∫—Ü–∏—è `save_entry()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (–∑–∞–≥–ª—É—à–∫–∞)

---

## üéâ –ü–†–û–ï–ö–¢ –ó–ê–í–ï–†–®–Å–ù!

**–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –Ω–∞ 100%**

- ‚úÖ 360dialog Cloud API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è
- ‚úÖ FSM —Å 5 —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã (5/5)
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è (7 —Ñ–∞–π–ª–æ–≤)
- ‚úÖ –õ–∏–Ω—Ç–µ—Ä –æ—à–∏–±–æ–∫: 0
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
```bash
python bot.py
```

**–û—Ç–ø—Ä–∞–≤—å—Ç–µ "start" –≤ WhatsApp –∏ –Ω–∞—á–Ω–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å!**

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 7 –Ω–æ—è–±—Ä—è 2024  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **PRODUCTION READY** üöÄ

---

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:
- Python 3.x
- Flask (–≤–µ–±-—Å–µ—Ä–≤–µ—Ä)
- Requests (HTTP –∫–ª–∏–µ–Ω—Ç)
- 360dialog Cloud API
- python-dotenv (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π)

**–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ!** üéâ

